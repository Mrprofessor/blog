<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.04b4bf291187ffa19a9f.css">html{font-size:16px}body{line-height:1.6em;color:#333;background:#fefefe}a{text-decoration:none}nav{font-size:1rem;text-align:center}nav ul{display:block;padding:0}nav ul li{display:inline;list-style-type:none}nav ul li a{display:inline-block;padding-top:.5rem;padding-bottom:.5rem;color:#444;border-bottom:1px solid #fefefe}nav ul li a:hover{color:#f93a3a;border-bottom:1px solid}nav ul li:not(:last-child){padding:0 1rem 0 0}.layout{max-width:48rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem}.layout .title-wrapper{display:flex;flex-direction:column;align-items:center;margin-bottom:.5rem}.layout .title{color:#333;text-align:left;display:block;font-size:1.875rem;font-weight:700;margin:0}.blog-list .list-item{display:flex;flex-direction:column-reverse;align-items:baseline;padding:.5rem .5rem .5rem 0}.blog-list .post-title a{text-decoration:none;color:#333;font-weight:600;border-bottom:none}.blog-list .post-title a:hover{color:#f93a3a}.blog-list .date-label{font-size:80%;margin-right:1rem}.content .title{color:#333;font-size:1.275rem}.blog-post-content a{color:#f93a3a;text-decoration:none;border-bottom:1px solid}.blog-post-content a:hover{border-bottom:none}.blog-post-content img{width:100%}.gatsby-highlight{font-size:80%;margin-left:-1.3125rem;margin-right:-1.3125rem}.gatsby-highlight pre[class*=language-]{border-radius:5px;overflow:auto;padding:1.3125rem;margin:0}.active-link{color:red}.disabled-link{cursor:not-allowed;opacity:.5;text-decoration:none;pointer-events:none}.slim-description{margin-bottom:32px}.project-board{margin-top:32px;display:grid;grid-template-columns:1fr;grid-template-rows:auto;grid-gap:20px;max-width:48rem}.card{min-height:100%;position:relative;display:flex;flex-direction:column;color:#444;text-decoration:none;border-radius:3px;border:1px solid #f93a3a}.card article{padding:20px}.card h4{font-size:20px;margin:0;color:#333}.card p{line-height:1.4}.custom-card-footer{display:flex;justify-content:flex-end}.custom-button{font-size:16px;margin:0 8px;padding:8px;border-radius:3px;border:1px solid #333;color:#f93a3a;background-color:transparent;cursor:pointer;-webkit-transition:color .3s;transition:color .3s}.custom-button:hover{border:1px solid #f93a3a;color:#333}.brand-icon{color:#f93a3a}.brand-icon:hover{border-bottom:1px solid}@media only screen and (min-width:600px){.layout .title-wrapper{display:flex;justify-content:space-between;align-items:center;flex-direction:row}.layout .title{-webkit-margin-before:.83em;margin-block-start:.83em;-webkit-margin-after:.83em;margin-block-end:.83em;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0}.blog-list .list-item{display:flex;justify-content:space-between;align-items:center;flex-direction:unset;padding:0;margin-bottom:.5rem}.blog-list .date-label{font-size:100%;margin-right:0}.project-board{grid-template-columns:1fr 1fr}.gatsby-highlight{margin-right:0;margin-left:0}}@font-face{font-family:Overpass Mono;font-style:normal;font-display:swap;font-weight:300;src:local("Overpass Mono Light "),local("Overpass Mono-Light"),url(/static/overpass-mono-latin-300-028e7a5e290fcf093423ba49da0201d6.woff2) format("woff2"),url(/static/overpass-mono-latin-300-78f259905f8cb5a93ecb91aeb39d48c7.woff) format("woff")}@font-face{font-family:Overpass Mono;font-style:normal;font-display:swap;font-weight:400;src:local("Overpass Mono Regular "),local("Overpass Mono-Regular"),url(/static/overpass-mono-latin-400-1d4bff23aec2805d01bf7d96c5d4d15f.woff2) format("woff2"),url(/static/overpass-mono-latin-400-721747e0e39a805a7c6111f43f36577b.woff) format("woff")}@font-face{font-family:Overpass Mono;font-style:normal;font-display:swap;font-weight:600;src:local("Overpass Mono SemiBold "),local("Overpass Mono-SemiBold"),url(/static/overpass-mono-latin-600-1a0c0c1227b432572dcfbe1c6ca66b6f.woff2) format("woff2"),url(/static/overpass-mono-latin-600-96374f612fd40cb0da8cc1814e818478.woff) format("woff")}@font-face{font-family:Overpass Mono;font-style:normal;font-display:swap;font-weight:700;src:local("Overpass Mono Bold "),local("Overpass Mono-Bold"),url(/static/overpass-mono-latin-700-034c90df1d5ecc07d98a4de1ea6cd3a6.woff2) format("woff2"),url(/static/overpass-mono-latin-700-b55fd97542c2bd711343958a89449cd9.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:.08em solid #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s linear infinite;animation:fa-spin 2s linear infinite}.fa-pulse{-webkit-animation:fa-spin 1s steps(8) infinite;animation:fa-spin 1s steps(8) infinite}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scaleX(-1);transform:scaleX(-1)}.fa-flip-vertical{-webkit-transform:scaleY(-1);transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical,.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1);transform:scale(-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fad.fa-inverse{color:#fff}</style><meta name="generator" content="Gatsby 2.15.15"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><style data-styled="" data-styled-version="4.3.2">
/* sc-component-id: sc-global-1337599976 */
@import url('https://fonts.googleapis.com/css?family=Overpass+Mono&display=swap+Display:400,700'); *{box-sizing:border-box;} body{margin:0;font-family:'Overpass Mono',monospace;}</style><link as="script" rel="preload" href="/component---src-templates-blog-template-js-37c2bf1237a9316f457a.js"/><link as="script" rel="preload" href="/commons-9949c69cd4e43c8b4230.js"/><link as="script" rel="preload" href="/app-398339d3be24d728dd84.js"/><link as="script" rel="preload" href="/styles-5de49135ef0a8fafd94a.js"/><link as="script" rel="preload" href="/webpack-runtime-f244396a03f69ed25ebc.js"/><link as="fetch" rel="preload" href="/page-data/blog/generate-and-serve-files-from-flask/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="layout"><div class="title-wrapper"><a href="/"><h2 class="title">rudra narayan</h2></a><nav><ul><li><a href="/blog/">blog</a></li><li><a href="/projects/">projects</a></li><li><a href="https://github.com/mrprofessor/resume/blob/master/rudra_narayan_resume.pdf" target="_blank">resume</a></li></ul></nav></div><div class="content"><h2 class="title">Generate and serve files from flask</h2><sub>October 05, 2019</sub><div class="blog-post-content"><p>Flask is one of the most used python frameworks for web development. Its
simplicity and extensibility makes it convenient for both small and large
applications alike.</p>
<p>In this blog we are going to create a simple flask web application that will
generate and serve files without storing them in the server.</p>
<blockquote>
<p>Note: For flask and python installation visit
<a href="https://flask.palletsprojects.com/en/1.1.x/">flask documentation</a></p>
</blockquote>
<p>Let's create a flask application with a basic route.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"Hello Flask!"</span></code></pre></div>
<p>and voila! We have our server up and running with only 5 lines of code.</p>
<p>Now we need to create a route which will accept a file name as parameter.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/file/&lt;file_name>"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> file_name</code></pre></div>
<p>For our use case we need to generate a csv file using fake data.We need to
install <a href="https://github.com/joke2k/faker">faker</a> to generate fake data such
as name, address, birthdate etc. Also we are using
<a href="https://github.com/pandas-dev/pandas">pandas</a> to generate dataframes that
can be used to create both csv and spreadsheets.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">python3 -m pip <span class="token function">install</span> faker pandas</code></pre></div>
<p>Let's add functions that will generate csv files using the fake data we get
from Faker.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_fake_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fake_data <span class="token operator">=</span> <span class="token punctuation">[</span>fake<span class="token punctuation">.</span>simple_profile<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>fake_data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">generate_csv_file</span><span class="token punctuation">(</span>file_df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Create an o/p buffer</span>
    file_buffer <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Write the dataframe to the buffer</span>
    file_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>file_buffer<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>

    <span class="token comment"># Seek to the beginning of the stream</span>
    file_buffer<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> file_buffer</code></pre></div>
<p>Now we need to call these functions from our routing method and send the file
as response.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/file/&lt;file_name>"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fake_df <span class="token operator">=</span> generate_fake_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
    generated_file <span class="token operator">=</span> generate_csv_file<span class="token punctuation">(</span>fake_df<span class="token punctuation">)</span>
    response <span class="token operator">=</span> Response<span class="token punctuation">(</span>generated_file<span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/csv"</span><span class="token punctuation">)</span>
    <span class="token comment"># add a filename</span>
    response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>
        <span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment"</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">"{0}.csv"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> response</code></pre></div>
<p>Once we hit the above route with a file name the browser will ask for
permission to download the csv file.</p>
<p>Here is the full source code with a working example.</p>
<div class="glitch-embed-wrap" style="height: 420px; width: 100%;">
  <iframe
    src="https://glitch.com/embed/#!/embed/exclusive-sneezeweed?path=server.py&previewSize=0"
    title="exclusive-sneezeweed on Glitch"
    style="height: 100%; width: 100%; border: 0;">
  </iframe>
</div>
<p>Feel free to edit and play around. Adios!</p></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/generate-and-serve-files-from-flask";window.webpackCompilationHash="5340ef53f897c011cea8";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-398339d3be24d728dd84.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-37c2bf1237a9316f457a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-14b3d48629c58ef39f08.js"],"component---src-pages-about-js":["/component---src-pages-about-js-4af5aa183ded39c6f985.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-63f3dde60566b9e01942.js"],"component---src-pages-index-js":["/component---src-pages-index-js-74045973de385c9eaeaa.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ba5fe3c6c5b83177c96e.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-071590510851a4863575.js"],"pdfjsWorker":["/pdfjsWorker-0e2924ee1aab743d3ac2.js"]};/*]]>*/</script><script src="/webpack-runtime-f244396a03f69ed25ebc.js" async=""></script><script src="/styles-5de49135ef0a8fafd94a.js" async=""></script><script src="/app-398339d3be24d728dd84.js" async=""></script><script src="/commons-9949c69cd4e43c8b4230.js" async=""></script><script src="/component---src-templates-blog-template-js-37c2bf1237a9316f457a.js" async=""></script></body></html>